<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Raspadinha</title>
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 95%;
            max-width: 900px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 600px;
        }

        .header {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .admin-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .admin-btn:hover {
            background: white;
            color: #333;
        }

        .content {
            padding: 30px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 50px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4ECDC4;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Control Panel */
        .control-panel {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .plays-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .plays-counter {
            font-size: 1.5em;
            font-weight: bold;
        }

        .enable-plays-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .enable-plays-btn:hover {
            background: white;
            color: #333;
        }

        .enable-plays-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Login Screen */
        .login-form {
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .login-form h2 {
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #4ECDC4;
        }

        .btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        /* Game Selection */
        .game-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .game-card {
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .game-card:hover {
            border-color: #4ECDC4;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .game-card img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .game-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .game-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-waiting {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #f8d7da;
            color: #721c24;
        }

        /* Scratch Game */
        .scratch-area {
            text-align: center;
            margin: 30px 0;
        }

        .numbers-grid {
            display: grid;
            gap: 8px;
            max-width: 100%;
            margin: 20px auto;
            padding: 15px;
            min-height: 150px;
            justify-content: center;
        }

        /* Responsividade baseada na quantidade de n√∫meros */
        .numbers-grid.small-count {
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
        }

        .numbers-grid.medium-count {
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 10px;
        }

        .numbers-grid.large-count {
            grid-template-columns: repeat(auto-fit, minmax(45px, 1fr));
            gap: 8px;
        }

        .numbers-grid.huge-count {
            grid-template-columns: repeat(auto-fit, minmax(35px, 1fr));
            gap: 6px;
        }

        .number-card {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #FFD700;
            position: relative;
            overflow: hidden;
            display: flex !important;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            aspect-ratio: 1;
        }

        /* Tamanhos adaptativos baseados na classe da grid */
        .small-count .number-card {
            padding: 18px;
            font-size: 20px;
            min-height: 70px;
        }

        .medium-count .number-card {
            padding: 12px;
            font-size: 16px;
            min-height: 55px;
        }

        .large-count .number-card {
            padding: 8px;
            font-size: 14px;
            min-height: 40px;
        }

        .huge-count .number-card {
            padding: 6px;
            font-size: 11px;
            min-height: 32px;
            border-radius: 8px;
        }

        .number-card:hover {
            transform: scale(1.05);
        }

        .number-card.scratched {
            background: linear-gradient(45deg, #e0e0e0, #f0f0f0);
            color: #333;
            cursor: default;
        }

        .number-card.winner {
            background: linear-gradient(45deg, #FF6B6B, #FF4757);
            color: white;
            animation: pulse 1s infinite;
        }

        .number-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #ccc;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .scratch-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, #C0C0C0, #A0A0A0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #666;
            cursor: pointer;
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: #ddd;
            border-radius: 10px;
            padding: 3px;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            height: 20px;
            border-radius: 7px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        /* Reports */
        .report-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .report-table th, .report-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .report-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .report-table tr:hover {
            background: #f5f5f5;
        }

        /* History */
        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .winner-animation {
            font-size: 3em;
            color: #FF6B6B;
            margin: 20px 0;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .config-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px;
        }

        .config-error h3 {
            margin-bottom: 15px;
        }

        .config-instructions {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .config-instructions h4 {
            margin-bottom: 10px;
        }

        .config-instructions code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .container {
                width: 98%;
                margin: 10px;
            }
            
            .numbers-grid {
                grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
                gap: 10px;
                padding: 15px;
                max-width: 100%;
            }
            
            .number-card {
                padding: 15px;
                font-size: 18px;
                min-height: 70px;
                min-width: 70px;
            }
            
            .plays-info {
                flex-direction: column;
                text-align: center;
            }
            
            .scratch-area h3 {
                font-size: 1.2em;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé∞ Raspadinha Premiada</h1>
            <button class="admin-btn" onclick="toggleAdmin()">üë§ Admin</button>
        </div>
        
        <div class="content">
            <!-- Configuration Error Screen -->
            <div id="configErrorScreen" class="screen">
                <div class="config-error">
                    <h3>‚ö†Ô∏è Configura√ß√£o do Firebase Necess√°ria</h3>
                    <p>As configura√ß√µes do Firebase n√£o foram encontradas ou est√£o inv√°lidas.</p>
                </div>
                
                <div class="config-instructions">
                    <h4>üìã Como Configurar:</h4>
                    <p><strong>1. Edite o arquivo e configure as vari√°veis de ambiente no in√≠cio do c√≥digo JavaScript:</strong></p>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px;">
// ==========================================
// üîß CONFIGURA√á√ïES DO FIREBASE (.env)
// ==========================================
const ENV = {
    FIREBASE_API_KEY: "",
    FIREBASE_AUTH_DOMAIN: "",
    FIREBASE_PROJECT_ID: "",
    FIREBASE_STORAGE_BUCKET: "",
    FIREBASE_MESSAGING_SENDER_ID: "",
    FIREBASE_APP_ID: ""
};</pre>
                    
                    <p><strong>2. Como obter essas informa√ß√µes:</strong></p>
                    <ul style="text-align: left; margin: 10px 0 10px 20px;">
                        <li>Acesse o <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a></li>
                        <li>Selecione seu projeto (ou crie um novo)</li>
                        <li>V√° em "Configura√ß√µes do projeto" > "Geral"</li>
                        <li>Na se√ß√£o "Seus apps", clique em "Configura√ß√£o" no app web</li>
                        <li>Copie as informa√ß√µes do <code>firebaseConfig</code></li>
                    </ul>
                    
                    <p><strong>3. Configure tamb√©m:</strong></p>
                    <ul style="text-align: left; margin: 10px 0 10px 20px;">
                        <li><strong>Authentication:</strong> Habilite "Email/senha" e crie um usu√°rio administrador</li>
                        <li><strong>Firestore Database:</strong> Crie um banco de dados (modo de teste inicialmente)</li>
                    </ul>
                </div>
                
                <div style="text-align: center;">
                    <button class="btn" onclick="location.reload()">üîÑ Recarregar P√°gina</button>
                </div>
            </div>

            <!-- Loading Screen -->
            <div id="loadingScreen" class="screen">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Conectando ao Firebase...</p>
                </div>
            </div>

            <!-- Login Screen -->
            <div id="loginScreen" class="screen">
                <div class="login-form">
                    <h2>Acesso ao Sistema</h2>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="adminEmail" placeholder="admin@exemplo.com">
                    </div>
                    <div class="form-group">
                        <label>Senha:</label>
                        <input type="password" id="adminPassword" placeholder="Digite a senha" onkeypress="checkEnter(event)">
                    </div>
                    <button class="btn" onclick="login()">Entrar como Admin</button>
                    <button class="btn btn-secondary" onclick="showGameSelection()">Jogar</button>
                    <div id="loginError" class="alert alert-error" style="display: none;"></div>
                </div>
            </div>

            <!-- Admin Dashboard -->
            <div id="adminScreen" class="screen">
                <h2>Painel Administrativo</h2>
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn" onclick="showCreateGame()">‚ûï Criar Novo Jogo</button>
                    <button class="btn btn-secondary" onclick="showGameSelection()">üéÆ Ver Jogos</button>
                    <button class="btn btn-warning" onclick="showReports()">üìä Relat√≥rios</button>
                    <button class="btn btn-secondary" onclick="showHistory()">üìã Hist√≥rico</button>
                    <button class="btn btn-secondary" onclick="logout()">üö™ Sair</button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalGames">0</h3>
                        <p>Jogos Criados</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalRevenue">R$ 0</h3>
                        <p>Arrecada√ß√£o Total</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="activeGames">0</h3>
                        <p>Jogos Ativos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalPlays">0</h3>
                        <p>Total de Jogadas</p>
                    </div>
                </div>
            </div>

            <!-- Create Game Screen -->
            <div id="createGameScreen" class="screen">
                <h2>Criar Novo Jogo</h2>
                <form onsubmit="createGame(event)">
                    <div class="form-group">
                        <label>Descri√ß√£o do Pr√™mio:</label>
                        <input type="text" id="prizeDescription" required placeholder="Ex: iPhone 15 Pro Max">
                    </div>
                    
                    <div class="form-group">
                        <label>Valor do Pr√™mio (R$):</label>
                        <input type="number" id="prizeValue" required min="1" step="0.01" placeholder="1000.00">
                    </div>
                    
                    <div class="form-group">
                        <label>Quantidade de N√∫meros:</label>
                        <input type="number" id="numbersCount" required min="5" max="500" placeholder="Ex: 20">
                        <small style="color: #666; font-size: 12px;">M√≠nimo: 5 n√∫meros | M√°ximo: 500 n√∫meros</small>
                    </div>
                    
                    <div class="alert alert-warning">
                        <strong>Aten√ß√£o:</strong> Cada jogada custar√° R$ 1,00 (valor fixo)
                    </div>
                    
                    <div class="form-group">
                        <label>URL da Foto do Pr√™mio:</label>
                        <input type="url" id="prizeImage" placeholder="https://exemplo.com/imagem.jpg">
                    </div>
                    
                    <div style="text-align: center;">
                        <button type="submit" class="btn">‚úÖ Criar Jogo</button>
                        <button type="button" class="btn btn-secondary" onclick="showAdmin()">‚ùå Cancelar</button>
                    </div>
                </form>
            </div>

            <!-- Game Selection Screen -->
            <div id="gameSelectionScreen" class="screen">
                <h2>Escolha seu Jogo</h2>
                <button class="btn btn-secondary" onclick="showLogin()" style="float: right;">üè† In√≠cio</button>
                <div id="gamesList" class="game-list">
                    <!-- Games will be populated here -->
                </div>
            </div>

            <!-- Game Play Screen -->
            <div id="gamePlayScreen" class="screen">
                <!-- Control Panel -->
                <div class="control-panel">
                    <div class="plays-info">
                        <div>
                            <span class="plays-counter">Jogadas Dispon√≠veis: <span id="availablePlays">0</span></span>
                        </div>
                        <button class="enable-plays-btn" onclick="showEnablePlaysModal()">
                            üîì Liberar Jogadas
                        </button>
                    </div>
                    <div style="font-size: 14px; opacity: 0.9;">
                        Cada jogada custa R$ 1,00 ‚Ä¢ Solicite libera√ß√£o ao administrador
                    </div>
                </div>

                <div id="gameInfo">
                    <!-- Game info will be populated here -->
                </div>
                
                <div class="scratch-area">
                    <h3>Clique nos n√∫meros para raspar:</h3>
                    <div id="numbersGrid" class="numbers-grid">
                        <!-- Numbers will be populated here -->
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <button class="btn btn-secondary" onclick="showGameSelection()">‚¨ÖÔ∏è Voltar</button>
                        <!-- <button class="btn btn-warning" onclick="showGameReport(currentGame.id)" id="reportButton">üìä Ver Relat√≥rio</button> -->
                    </div>
                </div>
            </div>

            <!-- Reports Screen -->
            <div id="reportsScreen" class="screen">
                <h2>Relat√≥rios de Jogos</h2>
                <button class="btn btn-secondary" onclick="showAdmin()" style="float: right;">‚¨ÖÔ∏è Voltar</button>
                <div id="reportsContent">
                    <!-- Reports will be populated here -->
                </div>
            </div>

            <!-- Game Report Screen -->
            <div id="gameReportScreen" class="screen">
                <h2>Relat√≥rio Detalhado</h2>
                <button class="btn btn-secondary" onclick="showGamePlayScreen()" style="float: right;">‚¨ÖÔ∏è Voltar</button>
                <div id="gameReportContent">
                    <!-- Game report will be populated here -->
                </div>
            </div>

            <!-- History Screen -->
            <div id="historyScreen" class="screen">
                <h2>Hist√≥rico de Jogos</h2>
                <button class="btn btn-secondary" onclick="showAdmin()" style="float: right;">‚¨ÖÔ∏è Voltar</button>
                <div id="historyList" class="history-list">
                    <!-- History will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Winner Modal -->
    <div id="winnerModal" class="modal">
        <div class="modal-content">
            <div class="winner-animation">üéâ</div>
            <h2>PARAB√âNS!</h2>
            <p id="winnerMessage"></p>
            <button class="btn" onclick="closeWinnerModal()">Continuar</button>
        </div>
    </div>

    <!-- Enable Plays Modal -->
    <div id="enablePlaysModal" class="modal">
        <div class="modal-content">
            <h3>üîì Liberar Jogadas</h3>
            <div class="form-group">
                <label>Senha do Administrador:</label>
                <input type="password" id="enablePlaysPassword" placeholder="Digite a senha">
            </div>
            <div class="form-group">
                <label>N√∫mero de Jogadas:</label>
                <input type="number" id="numberOfPlays" min="1" max="100" value="1" placeholder="Quantas jogadas liberar?">
            </div>
            <div style="margin: 20px 0; font-size: 14px; color: #666;">
                Custo total: R$ <span id="totalCost">1,00</span>
            </div>
            <button class="btn" onclick="enablePlays()">‚úÖ Liberar</button>
            <button class="btn btn-secondary" onclick="closeEnablePlaysModal()">‚ùå Cancelar</button>
        </div>
    </div>

    <script>
        // ==========================================
        // üîß CONFIGURA√á√ïES DO FIREBASE (.env)
        // ==========================================
        // SUBSTITUA ESTAS VARI√ÅVEIS PELAS SUAS CREDENCIAIS DO FIREBASE
        const ENV = {
            FIREBASE_API_KEY: "AIzaSyC38lT-q48FgGJQYTQyrt4ff_oIa4N-8rs",
            FIREBASE_AUTH_DOMAIN: "raspadinha-a3336.firebaseapp.com",
            FIREBASE_PROJECT_ID: "raspadinha-a3336",
            FIREBASE_STORAGE_BUCKET: "raspadinha-a3336.firebasestorage.app",
            FIREBASE_MESSAGING_SENDER_ID: "663047020334",
            FIREBASE_APP_ID: "1:663047020334:web:805a410cf61c05aaed24bf"
        };

        // ==========================================
        // üì± SISTEMA DE RASPADINHA
        // ==========================================

        // Firebase variables
        let db = null;
        let auth = null;
        let firebaseApp = null;
        let isFirebaseInitialized = false;

        // Game data storage
        let games = [];
        let currentGame = null;
        let isAdmin = false;
        let gameHistory = [];
        const PLAY_VALUE = 1; // Valor fixo por jogada

        // Validate and Initialize Firebase
        function validateConfig() {
            return ENV.FIREBASE_API_KEY && 
                   ENV.FIREBASE_AUTH_DOMAIN && 
                   ENV.FIREBASE_PROJECT_ID &&
                   ENV.FIREBASE_API_KEY.trim() !== "" &&
                   ENV.FIREBASE_AUTH_DOMAIN.trim() !== "" &&
                   ENV.FIREBASE_PROJECT_ID.trim() !== "";
        }

        async function initializeFirebase() {
            if (!validateConfig()) {
                console.error('Firebase configuration is missing or invalid');
                showScreen('configErrorScreen');
                return false;
            }

            const firebaseConfig = {
                apiKey: ENV.FIREBASE_API_KEY,
                authDomain: ENV.FIREBASE_AUTH_DOMAIN,
                projectId: ENV.FIREBASE_PROJECT_ID,
                storageBucket: ENV.FIREBASE_STORAGE_BUCKET,
                messagingSenderId: ENV.FIREBASE_MESSAGING_SENDER_ID,
                appId: ENV.FIREBASE_APP_ID
            };

            showScreen('loadingScreen');

            try {
                // Initialize Firebase
                firebaseApp = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();

                // Test connection
                await db.collection('test').doc('connection').set({
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    test: true
                });

                console.log('Firebase connected successfully');
                isFirebaseInitialized = true;
                
                await loadData();
                showLogin();
                return true;

            } catch (error) {
                console.error('Firebase initialization failed:', error);
                alert('Erro ao conectar com Firebase: ' + error.message);
                showScreen('configErrorScreen');
                return false;
            }
        }

        // Firebase Database Functions
        async function saveGame(game) {
            if (!db) return;
            try {
                await db.collection('games').doc(game.id.toString()).set(game);
                console.log('Game saved:', game.id);
            } catch (error) {
                console.error('Error saving game:', error);
                throw error;
            }
        }

        async function loadGames() {
            if (!db) return [];
            try {
                const snapshot = await db.collection('games').orderBy('created', 'desc').get();
                const games = [];
                snapshot.forEach(doc => {
                    games.push(doc.data());
                });
                return games;
            } catch (error) {
                console.error('Error loading games:', error);
                return [];
            }
        }

        async function saveGameHistory(historyEntry) {
            if (!db) return;
            try {
                await db.collection('gameHistory').add(historyEntry);
                console.log('History entry saved');
            } catch (error) {
                console.error('Error saving history:', error);
            }
        }

        async function loadGameHistory() {
            if (!db) return [];
            try {
                const snapshot = await db.collection('gameHistory').orderBy('timestamp', 'desc').get();
                const history = [];
                snapshot.forEach(doc => {
                    history.push(doc.data());
                });
                return history;
            } catch (error) {
                console.error('Error loading history:', error);
                return [];
            }
        }

        async function loadData() {
            try {
                games = await loadGames();
                gameHistory = await loadGameHistory();
                console.log('Data loaded:', { games: games.length, history: gameHistory.length });
                
                // Create sample game if no games exist
                if (games.length === 0) {
                    await createSampleGame();
                }
            } catch (error) {
                console.error('Error loading data:', error);
                // Create sample data on error
                games = [];
                gameHistory = [];
                await createSampleGame();
            }
        }

        async function createSampleGame() {
            const sampleGame = {
                id: Date.now(),
                description: "Pack de Heineken Long Neck (6 un)",
                value: 48,
                numbersCount: 100,
                playValue: PLAY_VALUE,
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='100' viewBox='0 0 300 100'%3E%3Crect fill='%2300A651' width='300' height='100' rx='20'/%3E%3Ctext x='50%25' y='40%25' font-size='16' fill='white' text-anchor='middle' dy='.3em'%3EPack Heineken%3C/text%3E%3Ctext x='50%25' y='45%25' font-size='14' fill='white' text-anchor='middle' dy='.3em'%3E(6 unidades)%3C/text%3E%3C/svg%3E",
                totalRevenue: 0,
                playedNumbers: [],
                winnerNumber: null,
                availablePlays: 0,
                totalPlaysEnabled: 0,
                status: 'active',
                created: new Date().toISOString(),
                playsHistory: []
            };
            
            games.push(sampleGame);
            try {
                await saveGame(sampleGame);
            } catch (error) {
                console.error('Error saving sample game:', error);
            }
        }

        // Screen Management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showLogin() {
            if (!isFirebaseInitialized) {
                showScreen('configErrorScreen');
                return;
            }
            showScreen('loginScreen');
        }

        function showAdmin() {
            updateAdminStats();
            showScreen('adminScreen');
        }

        function showCreateGame() {
            showScreen('createGameScreen');
        }

        function showGameSelection() {
            if (!isFirebaseInitialized) {
                showScreen('configErrorScreen');
                return;
            }
            populateGamesList();
            showScreen('gameSelectionScreen');
        }

        function showReports() {
            populateReports();
            showScreen('reportsScreen');
        }

        function showGamePlayScreen() {
            if (currentGame) {
                updateGamePlayScreen();
                showScreen('gamePlayScreen');
            }
        }

        function showHistory() {
            populateHistory();
            showScreen('historyScreen');
        }

        function toggleAdmin() {
            if (isAdmin) {
                showAdmin();
            } else {
                showLogin();
            }
        }

        function checkEnter(event) {
            if (event.key === 'Enter') {
                login();
            }
        }

        // Authentication
        async function login() {
            if (!auth) {
                alert('Firebase n√£o inicializado!');
                return;
            }

            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('loginError');

            if (!email || !password) {
                errorDiv.textContent = 'Por favor, preencha email e senha';
                errorDiv.style.display = 'block';
                return;
            }

            try {
                errorDiv.style.display = 'none';
                await auth.signInWithEmailAndPassword(email, password);
                isAdmin = true;
                showAdmin();
                document.getElementById('adminEmail').value = '';
                document.getElementById('adminPassword').value = '';
            } catch (error) {
                console.error('Login error:', error);
                errorDiv.textContent = 'Erro no login: ' + error.message;
                errorDiv.style.display = 'block';
            }
        }

        async function logout() {
            if (auth) {
                try {
                    await auth.signOut();
                } catch (error) {
                    console.error('Logout error:', error);
                }
            }
            isAdmin = false;
            showLogin();
        }

        // Admin Dashboard
        function updateAdminStats() {
            document.getElementById('totalGames').textContent = games.length;
            
            const totalRevenue = games.reduce((sum, game) => sum + game.totalRevenue, 0);
            document.getElementById('totalRevenue').textContent = `R$ ${totalRevenue.toFixed(2)}`;
            
            const activeGames = games.filter(game => game.status === 'active').length;
            document.getElementById('activeGames').textContent = activeGames;

            const totalPlays = games.reduce((sum, game) => sum + game.totalPlaysEnabled, 0);
            document.getElementById('totalPlays').textContent = totalPlays;
        }

        // Game Creation
        async function createGame(event) {
            event.preventDefault();
            
            const numbersCount = parseInt(document.getElementById('numbersCount').value);
            
            if (numbersCount < 5 || numbersCount > 500) {
                alert('A quantidade de n√∫meros deve estar entre 5 e 500!');
                return;
            }
            
            const newGame = {
                id: Date.now(),
                description: document.getElementById('prizeDescription').value,
                value: parseFloat(document.getElementById('prizeValue').value),
                numbersCount: numbersCount,
                playValue: PLAY_VALUE,
                image: document.getElementById('prizeImage').value || 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="200" viewBox="0 0 300 200"%3E%3Crect fill="%23ddd" width="300" height="200" rx="10"/%3E%3Ctext x="50%25" y="50%25" font-size="14" fill="%23666" text-anchor="middle" dy=".3em"%3ESem Imagem%3C/text%3E%3C/svg%3E',
                totalRevenue: 0,
                playedNumbers: [],
                winnerNumber: null,
                availablePlays: 0,
                totalPlaysEnabled: 0,
                status: 'active',
                created: new Date().toISOString(),
                playsHistory: []
            };
            
            try {
                await saveGame(newGame);
                games.push(newGame);
                
                // Reset form
                document.getElementById('prizeDescription').value = '';
                document.getElementById('prizeValue').value = '';
                document.getElementById('numbersCount').value = '';
                document.getElementById('prizeImage').value = '';
                
                alert('Jogo criado com sucesso!');
                showAdmin();
            } catch (error) {
                console.error('Error creating game:', error);
                alert('Erro ao criar jogo: ' + error.message);
            }
        }

        // Game Selection and Display
        function populateGamesList() {
            const gamesList = document.getElementById('gamesList');
            gamesList.innerHTML = '';
            
            games.forEach(game => {
                const requiredRevenue = game.value * 1.3;
                const progress = (game.totalRevenue / requiredRevenue) * 100;
                
                let statusClass = 'status-active';
                let statusText = 'Ativo';
                
                if (game.status === 'completed') {
                    statusClass = 'status-completed';
                    statusText = 'Finalizado';
                } else if (progress < 100) {
                    statusClass = 'status-waiting';
                    statusText = 'Coletando fundos';
                }
                
                const gameCard = document.createElement('div');
                gameCard.className = 'game-card';
                gameCard.onclick = () => startGame(game.id);
                gameCard.innerHTML = `
                    <img src="${game.image}" alt="${game.description}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'300\\' height=\\'200\\' viewBox=\\'0 0 300 200\\'%3E%3Crect fill=\\'%23ddd\\' width=\\'300\\' height=\\'200\\' rx=\\'10\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' font-size=\\'14\\' fill=\\'%23666\\' text-anchor=\\'middle\\' dy=\\'.3em\\'%3ESem Imagem%3C/text%3E%3C/svg%3E'">
                    <h3>${game.description}</h3>
                    <p><strong>Valor por jogada: R$ ${game.playValue.toFixed(2)}</strong></p>
                    <p>${game.numbersCount} n√∫meros dispon√≠veis</p>
                    <p>Jogadas realizadas: ${game.playedNumbers.length}</p>
                    <p>Arrecada√ß√£o: R$ ${game.totalRevenue.toFixed(2)}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(progress, 100)}%">
                            ${progress.toFixed(1)}%
                        </div>
                    </div>
                    <div class="game-status ${statusClass}">${statusText}</div>
                `;
                gamesList.appendChild(gameCard);
            });
        }

        function startGame(gameId) {
            currentGame = games.find(g => g.id === gameId);
            if (!currentGame) {
                console.error('Jogo n√£o encontrado com ID:', gameId);
                return;
            }
            
            if (currentGame.status === 'completed') {
                alert('Este jogo j√° foi finalizado!');
                return;
            }
            
            updateGamePlayScreen();
            showScreen('gamePlayScreen');
            
            setTimeout(() => {
                populateNumbers();
            }, 100);
        }

        function updateGamePlayScreen() {
            populateGameInfo();
            populateNumbers();
            updateAvailablePlays();
        }

        function populateGameInfo() {
            const gameInfo = document.getElementById('gameInfo');
            
            gameInfo.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <img src="${currentGame.image}" alt="${currentGame.description}" 
                         style="width: 200px; height: 150px; object-fit: cover; border-radius: 10px; margin-bottom: 15px;"
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'200\\' height=\\'150\\' viewBox=\\'0 0 200 150\\'%3E%3Crect fill=\\'%23ddd\\' width=\\'200\\' height=\\'150\\' rx=\\'10\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' font-size=\\'12\\' fill=\\'%23666\\' text-anchor=\\'middle\\' dy=\\'.3em\\'%3ESem Imagem%3C/text%3E%3C/svg%3E'">
                    <h3>${currentGame.description}</h3>
                    <p><strong>Valor da jogada: R$ ${currentGame.playValue.toFixed(2)}</strong></p>
                    <p style="font-size: 14px; color: #666; margin-top: 10px;">
                        ${currentGame.numbersCount} n√∫meros dispon√≠veis para raspar
                    </p>
                    <p style="font-size: 14px; color: #666;">
                        N√∫meros j√° raspados: ${currentGame.playedNumbers.length}
                    </p>
                </div>
            `;
        }

        function populateNumbers() {
            const numbersGrid = document.getElementById('numbersGrid');
            numbersGrid.innerHTML = '';
            
            if (!currentGame) {
                console.error('Jogo atual n√£o encontrado');
                return;
            }
            
            // Determinar classe responsiva baseada na quantidade de n√∫meros
            numbersGrid.className = 'numbers-grid';
            if (currentGame.numbersCount <= 20) {
                numbersGrid.classList.add('small-count');
            } else if (currentGame.numbersCount <= 40) {
                numbersGrid.classList.add('medium-count');
            } else if (currentGame.numbersCount <= 70) {
                numbersGrid.classList.add('large-count');
            } else {
                numbersGrid.classList.add('huge-count');
            }
            
            for (let i = 1; i <= currentGame.numbersCount; i++) {
                const numberCard = document.createElement('div');
                const isPlayed = currentGame.playedNumbers.includes(i);
                const hasAvailablePlays = currentGame.availablePlays > 0;
                
                numberCard.className = 'number-card';
                
                if (isPlayed) {
                    numberCard.classList.add('scratched');
                    numberCard.textContent = i;
                    numberCard.onclick = null;
                    
                    if (i === currentGame.winnerNumber && canWin()) {
                        numberCard.classList.add('winner');
                        numberCard.innerHTML = `${i}<br>üèÜ`;
                    }
                } else if (!hasAvailablePlays) {
                    numberCard.classList.add('disabled');
                    numberCard.innerHTML = `
                        <div class="scratch-overlay" style="font-size: ${currentGame.numbersCount > 50 ? '10px' : '12px'};">Sem jogadas</div>
                        <span style="position: relative; z-index: 1;">${i}</span>
                    `;
                    numberCard.onclick = null;
                } else {
                    numberCard.onclick = () => scratchNumber(i, numberCard);
                    numberCard.innerHTML = `
                        <div class="scratch-overlay" style="font-size: ${currentGame.numbersCount > 50 ? '10px' : '12px'};"></div>
                        <span style="position: relative; z-index: 1;">${i}</span>
                    `;
                }
                
                numbersGrid.appendChild(numberCard);
            }
        }

        function updateAvailablePlays() {
            document.getElementById('availablePlays').textContent = currentGame.availablePlays;
        }

        // Play Management
        function showEnablePlaysModal() {
            document.getElementById('enablePlaysModal').classList.add('show');
            document.getElementById('numberOfPlays').oninput = updateTotalCost;
            updateTotalCost();
        }

        function closeEnablePlaysModal() {
            document.getElementById('enablePlaysModal').classList.remove('show');
            document.getElementById('enablePlaysPassword').value = '';
            document.getElementById('numberOfPlays').value = '1';
        }

        function updateTotalCost() {
            const numberOfPlays = parseInt(document.getElementById('numberOfPlays').value) || 0;
            const totalCost = numberOfPlays * PLAY_VALUE;
            document.getElementById('totalCost').textContent = totalCost.toFixed(2);
        }

        async function enablePlays() {
            if (!auth.currentUser) {
                alert('Voc√™ precisa estar logado como administrador!');
                return;
            }

            const numberOfPlays = parseInt(document.getElementById('numberOfPlays').value);
            
            if (!numberOfPlays || numberOfPlays < 1) {
                alert('N√∫mero de jogadas inv√°lido!');
                return;
            }
            
            currentGame.availablePlays += numberOfPlays;
            currentGame.totalPlaysEnabled += numberOfPlays;
            
            // Registrar no hist√≥rico de libera√ß√£o
            currentGame.playsHistory.push({
                timestamp: new Date().toISOString(),
                playsEnabled: numberOfPlays,
                cost: numberOfPlays * PLAY_VALUE
            });
            
            try {
                await saveGame(currentGame);
                
                updateAvailablePlays();
                populateNumbers();
                closeEnablePlaysModal();
                
                alert(`${numberOfPlays} jogada(s) liberada(s) com sucesso!\nCusto total: R$ ${(numberOfPlays * PLAY_VALUE).toFixed(2)}`);
            } catch (error) {
                console.error('Error enabling plays:', error);
                alert('Erro ao liberar jogadas: ' + error.message);
            }
        }

        // Game Logic
        async function scratchNumber(number, card) {
            if (currentGame.playedNumbers.includes(number) || currentGame.availablePlays <= 0) return;
            
            // Reduzir jogadas dispon√≠veis
            currentGame.availablePlays--;
            
            // Adicionar receita
            currentGame.totalRevenue += currentGame.playValue;
            currentGame.playedNumbers.push(number);
            
            // Verificar se deve definir um vencedor
            checkAndSetWinner();
            
            // Atualizar card
            card.classList.add('scratched');
            card.innerHTML = number;
            card.onclick = null;
            
            // Verificar se √© o n√∫mero vencedor
            if (number === currentGame.winnerNumber && canWin()) {
                card.classList.add('winner');
                card.innerHTML = `${number}<br>üèÜ`;
                
                setTimeout(() => {
                    showWinner();
                    currentGame.status = 'completed';
                }, 500);
            }
            
            // Salvar no Firebase
            try {
                await saveGame(currentGame);
                
                // Salvar no hist√≥rico
                const historyEntry = {
                    gameId: currentGame.id,
                    gameDescription: currentGame.description,
                    number: number,
                    isWinner: number === currentGame.winnerNumber && canWin(),
                    value: currentGame.playValue,
                    timestamp: new Date().toISOString()
                };
                
                await saveGameHistory(historyEntry);
                gameHistory.unshift(historyEntry);
                
            } catch (error) {
                console.error('Error saving game state:', error);
                alert('Erro ao salvar jogada. Tente novamente.');
                return;
            }
            
            // Atualizar displays
            updateGamePlayScreen();
        }

        function checkAndSetWinner() {
            if (currentGame.winnerNumber !== null) {
                return; // J√° tem um vencedor definido
            }
            
            const requiredRevenue = currentGame.value * 1.3;
            if (currentGame.totalRevenue >= requiredRevenue) {
                // Escolher um n√∫mero aleat√≥rio entre os ainda n√£o jogados
                const availableNumbers = [];
                for (let i = 1; i <= currentGame.numbersCount; i++) {
                    if (!currentGame.playedNumbers.includes(i)) {
                        availableNumbers.push(i);
                    }
                }
                
                if (availableNumbers.length > 0) {
                    const randomIndex = Math.floor(Math.random() * availableNumbers.length);
                    currentGame.winnerNumber = availableNumbers[randomIndex];
                    console.log('N√∫mero vencedor escolhido:', currentGame.winnerNumber);
                }
            }
        }

        function canWin() {
            const requiredRevenue = currentGame.value * 1.3;
            return currentGame.totalRevenue >= requiredRevenue && currentGame.winnerNumber !== null;
        }

        function showWinner() {
            document.getElementById('winnerMessage').innerHTML = `
                Voc√™ ganhou o pr√™mio:<br>
                <strong>${currentGame.description}</strong><br>
                <small>Procure o organizador para retirar seu pr√™mio!</small>
            `;
            document.getElementById('winnerModal').classList.add('show');
        }

        function closeWinnerModal() {
            document.getElementById('winnerModal').classList.remove('show');
        }

        // Reports and History
        function populateReports() {
            const reportsContent = document.getElementById('reportsContent');
            reportsContent.innerHTML = '';
            
            games.forEach(game => {
                const requiredRevenue = game.value * 1.3;
                const profit = game.totalRevenue - game.value;
                
                const reportSection = document.createElement('div');
                reportSection.className = 'report-section';
                reportSection.innerHTML = `
                    <div class="report-header">
                        <h3>${game.description}</h3>
                        <button class="btn btn-secondary" onclick="showGameReport(${game.id})">Ver Detalhes</button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>R$ ${game.totalRevenue.toFixed(2)}</h3>
                            <p>Arrecada√ß√£o Total</p>
                        </div>
                        <div class="stat-card">
                            <h3>R$ ${game.value.toFixed(2)}</h3>
                            <p>Valor do Pr√™mio</p>
                        </div>
                        <div class="stat-card">
                            <h3>R$ ${profit.toFixed(2)}</h3>
                            <p>Lucro ${game.status === 'completed' ? 'Final' : 'Atual'}</p>
                        </div>
                        <div class="stat-card">
                            <h3>${game.playedNumbers.length}</h3>
                            <p>Jogadas Realizadas</p>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min((game.totalRevenue / requiredRevenue) * 100, 100)}%">
                            ${((game.totalRevenue / requiredRevenue) * 100).toFixed(1)}% da meta (R$ ${requiredRevenue.toFixed(2)})
                        </div>
                    </div>
                    
                    <p><strong>Status:</strong> ${game.status === 'completed' ? 'Finalizado' : 'Ativo'}</p>
                    <p><strong>Criado em:</strong> ${new Date(game.created).toLocaleString('pt-BR')}</p>
                `;
                reportsContent.appendChild(reportSection);
            });
        }

        function showGameReport(gameId) {
            const game = games.find(g => g.id === gameId);
            if (!game) return;
            
            const gameReportContent = document.getElementById('gameReportContent');
            const requiredRevenue = game.value * 1.3;
            const profit = game.totalRevenue - game.value;
            
            gameReportContent.innerHTML = `
                <div class="report-section">
                    <h3>${game.description}</h3>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>R$ ${game.totalRevenue.toFixed(2)}</h3>
                            <p>Arrecada√ß√£o Total</p>
                        </div>
                        <div class="stat-card">
                            <h3>R$ ${game.value.toFixed(2)}</h3>
                            <p>Valor do Pr√™mio</p>
                        </div>
                        <div class="stat-card">
                            <h3>R$ ${profit.toFixed(2)}</h3>
                            <p>Lucro ${game.status === 'completed' ? 'Final' : 'Atual'}</p>
                        </div>
                        <div class="stat-card">
                            <h3>${game.totalPlaysEnabled}</h3>
                            <p>Jogadas Liberadas</p>
                        </div>
                    </div>
                    
                    <h4>Hist√≥rico de Libera√ß√µes</h4>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>Data/Hora</th>
                                <th>Jogadas Liberadas</th>
                                <th>Custo</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${game.playsHistory.map(entry => `
                                <tr>
                                    <td>${new Date(entry.timestamp).toLocaleString('pt-BR')}</td>
                                    <td>${entry.playsEnabled}</td>
                                    <td>R$ ${entry.cost.toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <h4>N√∫meros Jogados</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px; margin: 15px 0;">
                        ${game.playedNumbers.map(num => `
                            <div style="background: ${num === game.winnerNumber && canWin() ? '#FF6B6B' : '#e0e0e0'}; 
                                        color: ${num === game.winnerNumber && canWin() ? 'white' : '#333'}; 
                                        padding: 10px; text-align: center; border-radius: 8px; font-weight: bold;">
                                ${num}${num === game.winnerNumber && canWin() ? ' üèÜ' : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="alert alert-success" style="margin-top: 20px;">
                        <strong>Resumo Financeiro:</strong><br>
                        ‚Ä¢ Total arrecadado: R$ ${game.totalRevenue.toFixed(2)}<br>
                        ‚Ä¢ Custo do pr√™mio: R$ ${game.value.toFixed(2)}<br>
                        ‚Ä¢ ${profit >= 0 ? 'Lucro' : 'Preju√≠zo'}: R$ ${Math.abs(profit).toFixed(2)}<br>
                        ‚Ä¢ Meta para libera√ß√£o do pr√™mio: R$ ${requiredRevenue.toFixed(2)}
                    </div>
                </div>
            `;
            
            showScreen('gameReportScreen');
        }

        function populateHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            if (gameHistory.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #666;">Nenhuma jogada registrada ainda.</p>';
                return;
            }
            
            gameHistory.forEach(play => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <h4>${play.gameDescription}</h4>
                    <p><strong>N√∫mero jogado:</strong> ${play.number} ${play.isWinner ? 'üèÜ VENCEDOR!' : ''}</p>
                    <p><strong>Valor:</strong> R$ ${play.value.toFixed(2)}</p>
                    <p><strong>Data:</strong> ${new Date(play.timestamp).toLocaleString('pt-BR')}</p>
                `;
                historyList.appendChild(historyItem);
            });
        }

        // Initialize the app
        window.onload = function() {
            initializeFirebase();
        };
    </script>
</body>
</html>